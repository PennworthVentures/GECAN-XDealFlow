<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ========================================================================= -->
    <!-- === DEFINITIVE FAVICON INTEGRATION (PINNACLE STANDARD) === -->
    <!-- ========================================================================= -->
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    <base target="_top">
    <title>GECAN™ Capital Nexus | Private Capital Marketplace</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- CUSTOM TAILWIND CONFIG (BENCHMARKED) -->
    <script>
        tailwind.config = {
            theme: {
                screens: {
                    'sm': '640px', 'md': '768px', 'lg': '1024px', 'xl': '1280px',
                    '2xl': '1536px', '3xl': '1920px',
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- PERFORMANCE FIX: Optimized Font Loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Orbitron:wght@400..900&family=JetBrains+Mono:wght@300..700&display=swap" rel="stylesheet">

    <style>
        /* ========================================================================= */
        /* === PINNACLE CSS ENGINE v5.0 (NEXUS EDITION) === */
        /* This stylesheet is the definitive standard, ensuring visual consistency */
        /* with the entire GECAN platform, plus Nexus-specific enhancements. */
        /* ========================================================================= */

        /* --- A. CORE THEME & VARIABLES (BENCHMARKED) --- */
        :root {
            --text-premium-gold: #EAE0C8;
            --brand-gecan-blue: #1c2e4a; --brand-gecan-gold: #b4975a; --primary-azure: #0ea5e9;
            --primary-sapphire: #3b82f6; --primary-royal: #6366f1; --primary-amethyst: #8b5cf6;
            --primary-diamond: #f8fafc; --primary-dark: #0369a1;
            --background-primary: #0a0a0f; --background-secondary: #1e293b; --background-light: #0f172a; --background-accent: #1e293b; --background-dark: #030712;
            --background-glass: rgba(15, 23, 42, 0.8); --background-glass-premium: rgba(15, 23, 42, 0.9);
            --border-color: rgba(148, 163, 184, 0.2); --border-secondary: rgba(148, 163, 184, 0.2);
            --border-premium: rgba(148, 163, 184, 0.3); --border-accent: #64748b;
            --text-diamond: #f8fafc; --text-platinum: #e2e8f0; --text-silver: #cbd5e1;
            --text-muted: #94a3b8; --text-subtle: #64748b; --text-primary: #f8fafc; --text-secondary: #a0aec0;
            --glow-azure: rgba(14, 165, 233, 0.8); --glow-sapphire: rgba(59, 130, 246, 0.9); --glow-gold: rgba(180, 151, 90, 0.7);
            --success-color: #22c55e; --warning-color: #f59e0b; --error-color: #ef4444; --critical-color: #dc2626;
            --gradient-primary: linear-gradient(135deg, #0ea5e9, #3b82f6, #8b5cf6);
            --shadow-ultra: 0 25px 50px -12px rgba(0, 0, 0, 0.25); --shadow-premium: 0 20px 25px -5px rgba(0, 0, 0, 0.8);
            --transform-ultra: translateY(-16px) rotateX(10deg) rotateY(5deg) scale(1.07);
        }

        /* --- B. BASE STYLES & RESETS --- */
        * { box-sizing: border-box; margin: 0; padding: 0; scroll-behavior: smooth; }
        html { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        body { font-family: 'Inter', sans-serif; background: var(--background-primary); color: var(--text-primary); min-height: 100vh; overflow-x: hidden; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: var(--background-secondary); } ::-webkit-scrollbar-thumb { background: var(--gradient-primary); border-radius: 4px; }
        ::selection { background: var(--gradient-primary); color: var(--text-diamond); }

        /* --- C. DYNAMIC BACKGROUND & PREMIUM HEADER (BENCHMARKED) --- */
        #particles-js { position: fixed; inset: 0; z-index: -2; pointer-events: none; }
        .premium-header { position: sticky; top: 0; z-index: 50; background: var(--background-glass-premium); backdrop-filter: blur(30px) saturate(180%); -webkit-backdrop-filter: blur(30px) saturate(180%); border-bottom: 1px solid var(--border-premium); box-shadow: var(--shadow-ultra); }
        .gecan-logo-container { perspective: 800px; }
        .gecan-logo-flipper { position: relative; width: 250px; height: 120px; transform-style: preserve-3d; transition: transform 1s cubic-bezier(0.19, 1, 0.22, 1); }
        .gecan-logo-container:hover .gecan-logo-flipper { transform: rotateY(180deg); }
        .logo-face { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; backface-visibility: hidden; }
        .logo-front { font-family: 'Orbitron', monospace; font-weight: 900; font-size: 2.5rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 40px var(--glow-azure); }
        .logo-back img { height: 100%; width: auto; object-fit: contain; filter: brightness(1.1) drop-shadow(0 0 10px var(--brand-gecan-gold)) drop-shadow(0 0 25px var(--brand-gecan-blue)); transform: rotateY(180deg); }
        .logo-separator { width: 6px; height: 120px; background: var(--gradient-primary); border-radius: 4px; box-shadow: 0 0 30px var(--glow-azure); }

        .nav-btn { background: var(--background-glass); border: 1px solid var(--border-secondary); color: var(--text-silver); font-weight: 500; padding: 0.75rem 1.25rem; border-radius: 1rem; transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 0.75rem; transform-style: preserve-3d; }
        .nav-btn:hover:not(.active) { background: var(--background-glass-premium); color: var(--text-diamond); transform: var(--transform-ultra); box-shadow: var(--shadow-premium), 0 0 60px var(--glow-azure); border-color: var(--border-premium); }
        .nav-btn.active { background: linear-gradient(135deg, rgba(180, 151, 90, 0.65), rgba(234, 179, 8, 0.5)), var(--background-glass); color: var(--text-premium-gold); font-weight: 700; border-color: var(--brand-gecan-gold); filter: brightness(1.1); animation: premium-gold-glow 2.5s ease-in-out infinite; }
        @keyframes premium-gold-glow { 50% { box-shadow: var(--shadow-ultra), 0 0 55px var(--glow-gold), 0 0 80px var(--warning-color); text-shadow: 0 0 12px rgba(255, 223, 150, 1), 0 0 30px var(--glow-gold); } }
        .nav-icon-wrapper { perspective: 500px; width: 24px; height: 24px; }
        .nav-icon-flipper { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.19, 1, 0.22, 1); }
        .nav-btn:hover:not(:active) .nav-icon-flipper { transform: rotateY(360deg); }
        .nav-icon-face { position: absolute; inset: 0; display: grid; place-items: center; backface-visibility: hidden; }
        .nav-icon-back { transform: rotateY(180deg); background: linear-gradient(135deg, var(--brand-gecan-gold), var(--warning-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 15px var(--glow-gold); }

        /* --- E. NEXUS-SPECIFIC STYLES (SEVERELY ENHANCED) --- */
        .glass-pane { background: var(--background-glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--border-color); }
        .btn-gold { background: linear-gradient(135deg, var(--brand-gecan-gold), var(--warning-color)); border: 1px solid var(--brand-gecan-gold); color: var(--background-dark); text-shadow: 0 1px 1px rgba(255,255,255,0.2); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(234, 179, 8, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2); }
        .btn-gold:hover:not(:disabled) { box-shadow: 0 8px 30px rgba(234, 179, 8, 0.4); transform: translateY(-3px); filter: brightness(1.1); }
        .form-input, .form-select { background-color: var(--background-dark); border: 1px solid var(--border-secondary); color: var(--text-primary); border-radius: 0.75rem; padding: 0.75rem 1rem; width: 100%; font-size: 1rem; transition: all 0.3s ease; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3); }
        .form-input::placeholder { color: var(--text-muted); }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--brand-gecan-gold); box-shadow: 0 0 0 4px rgba(180, 151, 90, 0.2), inset 0 2px 4px rgba(0,0,0,0.3); }
        
        .fade-in-up { animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; opacity: 0; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

        .role-selector-card { border: 2px solid var(--border-color); transition: all 0.3s ease; }
        .role-selector-card:hover { border-color: var(--brand-gecan-gold); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        .role-selector-card.active { border-color: var(--brand-gecan-gold); background: linear-gradient(145deg, rgba(180, 151, 90, 0.1), rgba(180, 151, 90, 0.05)); box-shadow: 0 0 25px var(--glow-gold); }

        .deal-card {
            border: 1px solid var(--border-secondary);
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            transform-style: preserve-3d;
            position: relative;
            overflow: hidden;
            background: linear-gradient(160deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.9));
        }
        .deal-card:hover {
            transform: perspective(1500px) rotateY(-5deg) scale(1.03);
            border-color: var(--brand-gecan-gold);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.6), 0 0 30px var(--glow-gold);
        }
        .deal-card-glow {
            position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(to right, transparent 0%, rgba(255, 215, 0, 0.15) 50%, transparent 100%);
            transform: skewX(-25deg); transition: left 1.2s ease-in-out;
        }
        .deal-card:hover .deal-card-glow { left: 150%; }

        .funding-progress-bar { background: var(--background-dark); box-shadow: inset 0 2px 4px rgba(0,0,0,0.5); }
        .funding-progress-fill { transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); background: linear-gradient(90deg, var(--warning-color), var(--brand-gecan-gold)); }

        .stat-card { background: rgba(0,0,0,0.2); border: 1px solid var(--border-secondary); }
        .stat-card .value { font-family: 'Orbitron', monospace; }
    </style>
</head>
<body class="min-h-screen">

    <div id="particles-js"></div>
    
    <!-- PREMIUM HEADER (BENCHMARKED & UNIFIED) -->
    <header class="premium-header p-4 lg:px-6">
        <div class="container mx-auto flex items-center justify-between gap-6">
            <div class="flex items-center gap-6 flex-shrink-0">
                <a href="./index.html" class="gecan-logo-container flex items-center gap-4 group">
                    <div class="gecan-logo-flipper">
                        <div class="logo-face logo-front">GECAN™</div>
                        <div class="logo-face logo-back">
                             <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSIjYjQ5NzVhIiBkPSJNNTAsMi41QTI0LjIsMjQuMiwwLDAsMCwyNS44LDI2LjdsMTIuMSw3YTEyLjEsMTIuMSwwLDAsMSwxMi4xLTEyLjFabTAsODVhMjQuMiwyNC4yLDAsMCwwLDI0LjItMjQuMkw2Mi4xLDY2LjNhMTIuMSwxMi4xLDAsMCwxLTEyLjEsMTIuMVptLTM1LjQtMjBhMjQuMiwyNC4yLDAsMCwwLDIxLjYsMjEuNkwyNC4xLDYyLjFBNTEuMyw1MS4zLDAsMCwxLDE0LjYsNzBabTE4LjMtNDEuN0wyMC44LDMyLjVhMjQuMiwyNC4yLDAsMCwwLDAsMzVsMTIuMS03YTEyLjEsMTIuMSwwLDAsMSwwLTE3LjlaTTc5LjIsMzIuNUw2Ny4xLDM5LjdhMTIuMSwxMi4xLDAsMCwxLDAsMTcuOWwxMi4xLDdhMjQuMiwyNC4yLDAsMCwwLDAtMzVaTTUwLDQxLjZhOC40LDguNCwwLDEsMCw4LjQsOC40QTguNCw4LjQsMCwwLDAsNTAsNDEuNloiLz48L3N2Zz4=" alt="GECAN Logo">
                        </div>
                    </div>
                    <div class="logo-separator"></div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold text-white">Capital Nexus</h1>
                        <p class="text-sm text-gray-400 font-mono">Private Capital Marketplace</p>
                    </div>
                </a>
            </div>
            <nav id="nav-container" class="hidden xl:flex items-center justify-center gap-3 bg-black/20 backdrop-blur-sm border border-white/10 p-2 rounded-xl">
                <!-- Navigation is dynamically injected by JavaScript -->
            </nav>
        </div>
    </header>

    <main id="main-content" class="container mx-auto p-4 md:p-8">
        <!-- The entire UI will be dynamically rendered here by JavaScript -->
    </main>
    
    <footer class="mt-auto pt-16">
        <div class="container mx-auto p-6 md:p-10 border-t border-border-color">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-sm text-text-silver">
                <div>
                    <h3 class="font-bold text-lg mb-3 bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-blue-600">GECAN™</h3>
                    <p class="mb-2">Global Energy & Commodities Alliance Network. Powered by Pennworth Ventures.</p>
                    <p class="text-xs text-text-muted">© 2025 GECAN™. All Rights Reserved.</p>
                </div>
                <div>
                    <h4 class="font-semibold text-white mb-3">Legal Disclaimer</h4>
                    <p class="text-xs leading-relaxed">GECAN Capital Nexus is a platform connecting verified parties. All investments carry significant risk. GECAN™ is not a registered broker-dealer, investment advisor, or funding portal and does not engage in any activities requiring such registration.</p>
                </div>
                <div>
                    <h4 class="font-semibold text-white mb-3">Risk & Compliance</h4>
                    <p class="text-xs leading-relaxed">All participants are subject to rigorous KYC/AML verification. Users must conduct their own independent due diligence. GECAN™ makes no warranties regarding the performance of any listed opportunity.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ====================================================================================
        // === GECAN™ CAPITAL NEXUS ENGINE v1.0 (PINNACLE STANDARD) ===
        // This engine is the definitive, production-grade standard for the Capital Nexus.
        // It manages the entire dual-sided marketplace workflow, from authentication and
        // role selection to deal origination and investment.
        // ====================================================================================
        
        const API_URL = "https://script.google.com/macros/s/AKfycbx2iCFhN8RB-sMQxBKu9d8NGUEbBLm2wKhRosXE6L4UNVifh59O5JDAbgoTU_q4zJkc/exec";

        const AppState = { 
            isAuthenticated: false,
            referralInfo: null,
            userRole: null, // 'originator' or 'investor'
            activeDeals: [],
            isLoading: true,
            currentView: 'auth', // 'auth', 'role_select', 'originator_dashboard', 'investor_dashboard'
        };

        const Utils = {
            createApiRequest: async (action, method = 'POST', params = {}) => {
                const url = new URL(API_URL);
                const options = {
                    method: method.toUpperCase(),
                    redirect: 'follow',
                    body: JSON.stringify({ action, data: params }),
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }
                };
                try {
                    const response = await fetch(url, options);
                    const resultText = await response.text();
                    if (!response.ok) throw new Error(`API Network Error: Status ${response.status} - ${resultText}`);
                    const result = JSON.parse(resultText);
                    if (result.success === false) throw new Error(result.error || 'An unknown server error occurred.');
                    return result.data || result.message || result;
                } catch (error) {
                    console.error(`API Error for action '${action}':`, error);
                    throw error;
                }
            },
            formatCurrency: (amount, currency = 'USD') => new Intl.NumberFormat('en-US', { style: 'currency', currency, minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount),
            showNotification: (message, type = 'info', duration = 4000) => {
                const toast = document.createElement('div');
                const colors = {
                    success: 'from-green-500 to-emerald-600',
                    error: 'from-red-500 to-rose-600',
                    info: 'from-sky-500 to-blue-600'
                };
                const icons = { success: 'fa-check-circle', error: 'fa-times-circle', info: 'fa-info-circle' };
                toast.className = `fixed top-5 right-5 p-4 rounded-xl shadow-2xl z-[200] text-white font-medium bg-gradient-to-br ${colors[type]} transform translate-x-full transition-all duration-500 ease-out`;
                toast.innerHTML = `<div class="flex items-center gap-3"><i class="fas ${icons[type]} text-lg"></i><span>${message}</span></div>`;
                document.body.appendChild(toast);
                requestAnimationFrame(() => { toast.style.transform = 'translateX(0)'; });
                setTimeout(() => { toast.style.transform = 'translateX(120%)'; toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, duration);
            },
        };

        const UI = {
            init: () => {
                if (typeof particlesJS !== 'undefined') { 
                    particlesJS('particles-js', {"particles":{"number":{"value":50,"density":{"enable":true,"value_area":1200}},"color":{"value":"#334155"},"shape":{"type":"circle"},"opacity":{"value":0.4,"random":true},"size":{"value":2,"random":true},"line_linked":{"enable":true,"distance":180,"color":"#475569","opacity":0.2,"width":1},"move":{"enable":true,"speed":0.8,"direction":"none","random":true,"straight":false,"out_mode":"out","bounce":false}},"interactivity":{"detect_on":"canvas","events":{"onhover":{"enable":true,"mode":"grab"},"onclick":{"enable":false}},"modes":{"grab":{"distance":200,"line_linked":{"opacity":0.5}}}},"retina_detect":true}); 
                }
                UI.populateNavLinks();
                UI.render();
            },
            populateNavLinks: () => {
                const navContainer = document.getElementById('nav-container');
                const links = [
                    { page: 'index', icon: 'fas fa-tachometer-alt', text: 'XDealFlow Home' },
                    { page: 'toolkits', icon: 'fas fa-tools', text: 'Intelligent Toolkits' },
                    { page: 'architect', icon: 'fas fa-drafting-compass', text: 'Architect Wizard' },
                    { page: 'intelligence', icon: 'fas fa-sitemap', text: 'Network Intelligence' },
                    { page: 'nexus', icon: 'fas fa-layer-group', text: 'Capital Nexus' }
                ];
                navContainer.innerHTML = links.map(link => {
                    const isActive = link.page === 'nexus';
                    const btnClass = isActive ? 'nav-btn active' : 'nav-btn';
                    return `<a href="./${link.page}.html" class="${btnClass}"><div class="nav-icon-wrapper"><div class="nav-icon-flipper"><div class="nav-icon-face nav-icon-front"><i class="${link.icon}"></i></div><div class="nav-icon-face nav-icon-back"><i class="${link.icon}"></i></div></div></div><span class="nav-text">${link.text}</span></a>`;
                }).join('');
            },
            render: () => {
                const mainContent = document.getElementById('main-content');
                let html = '';
                switch(AppState.currentView) {
                    case 'auth':
                        html = UI.ComponentBuilders.renderAuthGate();
                        break;
                    case 'role_select':
                        html = UI.ComponentBuilders.renderRoleSelector();
                        break;
                    case 'investor_dashboard':
                        html = UI.ComponentBuilders.renderInvestorDashboard(AppState.activeDeals);
                        break;
                    case 'originator_dashboard':
                        html = UI.ComponentBuilders.renderOriginatorDashboard();
                        break;
                    default:
                        html = UI.ComponentBuilders.renderAuthGate();
                }
                mainContent.innerHTML = html;
                Logic.bindEventListenersForView(AppState.currentView);
            }
        };

        const ComponentBuilders = {
            renderAuthGate: () => `
                <div class="glass-pane rounded-2xl p-6 md:p-10 max-w-lg mx-auto shadow-2xl fade-in-up text-center">
                    <i class="fas fa-shield-alt text-5xl text-primary-azure mb-4 text-shadow-[0_0_20px_var(--glow-azure)]"></i>
                    <h2 class="text-3xl font-bold text-white mb-2">Capital Nexus Portal</h2>
                    <p class="text-text-secondary mb-8">Access to this private capital marketplace is restricted. Please authenticate with your GECAN Partner ID.</p>
                    <div class="flex items-center gap-3">
                        <input type="text" id="referral-id-input" placeholder="Enter Partner Referral ID" class="flex-grow form-input p-3 text-white rounded-xl focus:outline-none text-sm font-mono tracking-wider">
                        <button id="validate-id-btn" class="btn-gold font-bold py-3 px-6 rounded-xl disabled:opacity-50">Authenticate</button>
                    </div>
                    <p id="referral-error" class="text-sm text-error-color mt-3 h-5"></p>
                </div>`,
            renderRoleSelector: () => `
                <div class="text-center fade-in-up">
                    <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">Welcome, ${AppState.referralInfo.partnerName}</h2>
                    <p class="text-text-secondary mb-10 max-w-2xl mx-auto">Select your objective for this session. Your access will be tailored to your role as either a deal originator seeking capital or an investor seeking opportunities.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                        <div id="role-originator" class="role-selector-card p-8 rounded-2xl cursor-pointer">
                            <i class="fas fa-project-diagram fa-3x text-primary-azure mb-4"></i>
                            <h3 class="text-2xl font-bold text-white">I Need Funding</h3>
                            <p class="text-text-secondary mt-2">Submit and structure a project or transaction to syndicate with the GECAN™ investor network.</p>
                        </div>
                        <div id="role-investor" class="role-selector-card p-8 rounded-2xl cursor-pointer">
                            <i class="fas fa-chart-line fa-3x text-success-color mb-4"></i>
                            <h3 class="text-2xl font-bold text-white">I Want to Invest</h3>
                            <p class="text-text-secondary mt-2">Access the private deal room to review and participate in vetted, high-yield opportunities.</p>
                        </div>
                    </div>
                </div>`,
            renderInvestorDashboard: (deals) => `
                <div class="fade-in-up">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">Investor Deal Room</h2>
                        <p class="text-text-secondary max-w-3xl mx-auto">Below is a curated list of active, vetted investment opportunities on the GECAN™ Capital Nexus. All deals have undergone preliminary due diligence.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        ${deals.length > 0 ? deals.map(ComponentBuilders.createDealCard).join('') : '<p class="col-span-full text-center text-text-muted py-16">There are currently no active deals matching your investment profile. New opportunities are vetted and listed frequently.</p>'}
                    </div>
                </div>`,
            createDealCard: (deal) => {
                const percentageFunded = (deal.fundedAmount / deal.fundingGoal) * 100;
                return `
                <div class="deal-card rounded-2xl flex flex-col h-full group">
                    <div class="deal-card-glow"></div>
                    <div class="p-6 relative z-10">
                        <div class="flex justify-between items-start">
                            <span class="text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-full bg-brand-gecan-gold/20 text-brand-gecan-gold border border-brand-gecan-gold/30">${deal.assetClass}</span>
                            <span class="text-sm font-semibold text-text-secondary">Term: <strong class="text-white">${deal.termMonths} Months</strong></span>
                        </div>
                        <h3 class="text-xl font-bold text-white mt-4 mb-2 line-clamp-2">${deal.projectName}</h3>
                        <p class="text-sm text-text-secondary line-clamp-3">${deal.description}</p>
                    </div>
                    <div class="mt-auto p-6 relative z-10">
                        <div class="grid grid-cols-2 gap-4 text-center mb-4">
                            <div class="stat-card p-3 rounded-lg"><p class="text-xs text-text-muted">Target ROI</p><p class="value text-2xl text-success-color">${deal.projectedROI}%</p></div>
                            <div class="stat-card p-3 rounded-lg"><p class="text-xs text-text-muted">Integrity Score</p><p class="value text-2xl text-primary-azure">${deal.integrityScore}/100</p></div>
                        </div>
                        <div class="mb-2">
                            <div class="flex justify-between text-xs font-mono text-text-muted mb-1">
                                <span>FUNDING PROGRESS</span>
                                <span>${percentageFunded.toFixed(1)}%</span>
                            </div>
                            <div class="funding-progress-bar w-full rounded-full h-2.5">
                                <div class="funding-progress-fill h-2.5 rounded-full" style="width: ${percentageFunded}%"></div>
                            </div>
                            <div class="flex justify-between text-xs font-mono text-text-muted mt-1">
                                <span>${Utils.formatCurrency(deal.fundedAmount)}</span>
                                <span>${Utils.formatCurrency(deal.fundingGoal)}</span>
                            </div>
                        </div>
                        <button class="btn-gold w-full mt-4 py-3 font-bold rounded-lg">View Deal & Invest</button>
                    </div>
                </div>`;
            },
            renderOriginatorDashboard: () => `
                <div class="fade-in-up">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">Deal Originator Dashboard</h2>
                        <p class="text-text-secondary max-w-3xl mx-auto">Submit a new funding proposal or manage your existing deals on the GECAN™ Capital Nexus.</p>
                    </div>
                    <!-- Placeholder for originator-specific content: a list of their deals and a "Create New Deal" button -->
                    <div class="glass-pane rounded-2xl p-12 text-center">
                        <i class="fas fa-plus-circle text-5xl text-primary-azure mb-4"></i>
                        <h3 class="text-2xl font-bold text-white">Submit New Funding Proposal</h3>
                        <p class="text-text-secondary mt-2 mb-6">Launch the Deal Abstract & Tokenization (DAT) Engine wizard to structure and submit your opportunity.</p>
                        <button class="btn-gold font-bold py-3 px-8 rounded-lg">Begin Structuring</button>
                    </div>
                </div>`,
        };

        const Logic = {
            init: () => {
                UI.init();
            },
            validatePremiumCode: async () => {
                const btn = document.getElementById('validate-id-btn');
                const input = document.getElementById('access-code-input');
                const errorEl = document.getElementById('referral-error');
                if (!input || !btn || !errorEl) return;
                
                const accessCode = input.value.trim().toUpperCase();
                if (!accessCode) {
                    errorEl.textContent = 'Access Code cannot be empty.';
                    return;
                }
                
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                errorEl.textContent = '';

                try {
                    const response = await Utils.createApiRequest('validatePremiumAccessCode', 'POST', { accessCode });
                    if (response && response.isValid) {
                        AppState.isAuthenticated = true;
                        AppState.referralInfo = { id: response.partnerId, partnerName: response.partnerName };
                        AppState.currentView = 'role_select';
                        Utils.showNotification(`Authentication Successful. Welcome, ${response.partnerName}.`, 'success');
                        UI.render();
                    } else {
                        throw new Error(response.message || 'Invalid or inactive Access Code.');
                    }
                } catch (error) {
                    errorEl.textContent = error.message;
                    btn.disabled = false;
                    btn.innerHTML = 'Authenticate';
                }
            },
            selectRole: async (role) => {
                AppState.userRole = role;
                AppState.currentView = role === 'investor' ? 'investor_dashboard' : 'originator_dashboard';
                UI.render(); // Render the appropriate dashboard shell
                
                // Fetch data needed for the selected dashboard
                if (role === 'investor') {
                    try {
                        const deals = await Utils.createApiRequest('getActiveDeals', 'POST', { tier: 'premium' }); // Example
                        AppState.activeDeals = deals;
                    } catch (error) {
                        Utils.showNotification(`Failed to load deal room: ${error.message}`, 'error');
                        AppState.activeDeals = [];
                    }
                }
                // Re-render with the fetched data
                UI.render();
            },
            bindEventListenersForView: (view) => {
                switch(view) {
                    case 'auth':
                        document.getElementById('validate-id-btn')?.addEventListener('click', Logic.validatePremiumCode);
                        document.getElementById('referral-id-input')?.addEventListener('keypress', e => { if (e.key === 'Enter') Logic.validatePremiumCode(); });
                        break;
                    case 'role_select':
                        document.getElementById('role-originator')?.addEventListener('click', () => Logic.selectRole('originator'));
                        document.getElementById('role-investor')?.addEventListener('click', () => Logic.selectRole('investor'));
                        break;
                    case 'investor_dashboard':
                        // Event listeners for deal cards would be attached here if they had complex actions
                        break;
                    case 'originator_dashboard':
                        // Event listener for "Begin Structuring" button
                        break;
                }
            }
        };
        
        document.addEventListener('DOMContentLoaded', UI.init);
    </script>
</body>
</html>
